<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advice Detail</title>
    <style>
        .error {
            color: red;
        }
        .success {
            color: blue;
        }
    </style>
</head>
<body>
    <a href="{% url 'home:advice_list' %}">뒤로가기</a>

    <h1>{{ advice.title }}</h1>
    <p>{{ advice.content }}</p>
    작성자: {{ advice.author.username }}<br>
    직책 부서 이름: {{ advice.author.job_type }}<br>
    <p>회사 분야: {{ advice.author.job_type }}</p>
    <p>작성 시간: {{ advice.created_at|date:"Y.m.d   A h:i" }}</p>
    {% if advice.photo %}
        <img src="{{ advice.photo.url }}" alt="{{ advice.title }}" style="width: 100px; height: auto;">
    {% else %}
        <p>조언 사진 없음</p>
    {% endif %}
    <p>좋아요 수: {{ advice.like_count }}</p>
    <form method="post" action="{% url 'home:advice_like' advice.id %}">
        {% csrf_token %}
        <button type="submit">
            {% if request.user in advice.likes.all %}
                좋아요 취소
            {% else %}
                좋아요
            {% endif %}
        </button>
    </form>

    {% if request.user == advice.author or request.user.is_staff %}
    <form method="post" action="{% url 'home:advice_delete' advice.id %}" onsubmit="return confirm('게시물을 삭제하시겠습니까?');">
        {% csrf_token %}
        <button type="submit">삭제</button>
    </form>
    <form method="post" action="{% url 'home:advice_edit' advice.id %}" onsubmit="return confirm('게시물을 수정하시겠습니까?');">
        {% csrf_token %}
        <button type="submit">수정</button>
    </form>
    {% endif %}


    <div class="messages">
        {% for message in messages %}
            <div class="message {% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    </div>

    <script>
        // 1초 후 메시지 숨기기
        setTimeout(function() {
            var messages = document.querySelectorAll('.messages .message');
            messages.forEach(function(message) {
                message.style.display = 'none';
            });
        }, 1000);

        // 페이지를 나갈 때 메시지 리셋
        window.addEventListener('beforeunload', function() {
            var messages = document.querySelectorAll('.messages .message');
            messages.forEach(function(message) {
                message.remove();
            });
        });
    </script>
</body>
</html>